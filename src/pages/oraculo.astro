---
import Layout from '../layouts/Layout.astro';
---

<Layout title="OR츼CULO DE HIERRO | Sentencia de la Calle">
  <div class="min-h-screen bg-[#050505] text-white font-sans flex flex-col items-center justify-center p-4 md:p-8 selection:bg-yellow-600">
    
    <div class="max-w-2xl w-full">

      <!-- HEADER -->
      <div class="text-center mb-12 md:mb-20 space-y-3">
        <h1 class="text-6xl md:text-8xl lg:text-9xl font-black tracking-tighter text-yellow-600 uppercase italic leading-[0.85]">
          OR츼CULO<br /><span class="text-white">DE HIERRO</span>
        </h1>
        <div class="h-1 w-24 bg-yellow-600 mx-auto mt-6"></div>
        <p class="text-zinc-600 tracking-[0.6em] text-[10px] md:text-xs font-bold uppercase pt-3">
          Justicia Final // E.U.L.M
        </p>
      </div>

      <!-- ZONA DE CONSULTA -->
      <div class="space-y-6 md:space-y-8">

        <p class="text-center text-zinc-500 text-xs uppercase tracking-widest font-bold">
          ESCRIBA EN QU칄 FALL칍 HOY
        </p>

        <div class="bg-zinc-950 border border-zinc-900 p-6 md:p-8 rounded-sm">
          <textarea
            id="consulta-input"
            class="w-full bg-transparent text-white outline-none text-xl md:text-2xl placeholder:text-zinc-700 text-center uppercase font-bold resize-none min-h-[80px]"
            placeholder="EJEMPLOS:
NO ENTREN칄
PROCRASTIN칄 TODO EL D칈A
ROMP칈 EL H츼BITO
NO HICE NADA"
            rows="3"></textarea>
        </div>

        <button
          id="btn-consultar"
          class="w-full border-2 border-yellow-600 text-yellow-600 hover:bg-yellow-600 hover:text-black font-black py-5 uppercase italic tracking-[0.25em] transition-all active:scale-[0.98]">
          D칈GAME C칍MO VOLVER
        </button>

        <!-- RESULTADO -->
        <div id="resultado-seccion" class="hidden space-y-10 pt-10">

          <div class="bg-zinc-950 border-2 border-yellow-600 p-10 rounded-sm relative overflow-hidden">
            <div class="absolute top-4 left-4 text-6xl text-zinc-900 font-serif">"</div>
            <div class="absolute bottom-4 right-4 text-6xl text-zinc-900 font-serif">"</div>
            <p
              id="respuesta-texto"
              class="text-4xl md:text-5xl font-black uppercase italic text-center leading-tight">
            </p>
          </div>

          <!-- ACCIONES -->
          <div class="space-y-4">
            <button
              id="btn-compartir-nativa"
              class="w-full bg-yellow-600 text-black font-black py-5 uppercase tracking-[0.3em]">
              游닆 COMPARTIR DICTAMEN
            </button>

            <div class="grid grid-cols-4 gap-2 pt-4 border-t border-zinc-900">
              <button data-format="post" class="btn-download border border-zinc-800 p-4 text-[10px] uppercase">POST</button>
              <button data-format="story" class="btn-download border border-zinc-800 p-4 text-[10px] uppercase">STORY</button>
              <button data-format="fb" class="btn-download border border-zinc-800 p-4 text-[10px] uppercase">FB</button>
              <button data-format="tw" class="btn-download border border-zinc-800 p-4 text-[10px] uppercase">TW</button>
            </div>
          </div>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="text-center mt-20 opacity-40">
        <p class="text-zinc-700 text-[9px] uppercase tracking-widest">
          La sentencia es inapelable
        </p>
      </div>
    </div>
  </div>

  <canvas id="hidden-canvas" style="display:none;"></canvas>
</Layout>

<script lang="ts" is:inline>
  const btn = document.getElementById('btn-consultar') as HTMLButtonElement | null;
  const input = document.getElementById('consulta-input') as HTMLTextAreaElement | null;
  const resBox = document.getElementById('resultado-seccion') as HTMLDivElement | null;
  const resText = document.getElementById('respuesta-texto') as HTMLParagraphElement | null;

  // Si algo no existe, salimos. Astro queda tranquilo.
  if (!btn || !input || !resBox || !resText) {
    console.error('ELEMENTOS DEL OR츼CULO NO ENCONTRADOS');
  } else {

    btn.addEventListener('click', async () => {
      const consulta = input.value.trim();

      if (!consulta) {
        input.focus();
        return;
      }

      const textoOriginal = btn.innerText;
      btn.innerText = 'DICTANDO SENTENCIA...';
      btn.disabled = true;

      try {
        const r = await fetch('https://mis-frases.poderparatriunfar.workers.dev/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: `
CONTEXTO:
El usuario admite EN QU칄 FALL칍 HOY: "${consulta}".
No busca consuelo. Busca direcci칩n.

TU PERSONALIDAD:
Autoridad serena. Lenguaje elegante y firme.
Hablas como un l칤der que espera excelencia.

OBJETIVO 칔NICO:
EVITAR QUE EL USUARIO ABANDONE.
Convertir el error de hoy en una decisi칩n clara de volver ma침ana.

REGLAS OBLIGATORIAS:
- UNA sola frase
- M치ximo 12 palabras
- TODO en MAY칔SCULAS
- Debe mencionar MA칌ANA, VOLVER o DISCIPLINA
- Acci칩n clara, sin met치foras complejas

USUARIO: ${consulta}

DICTE SENTENCIA:
`
          })
        });

        const data = await r.json();
        const frase = data.response || data.text || 'EL SILENCIO ES LA RESPUESTA.';

        resText.innerText = frase;
        resBox.classList.remove('hidden');
        resBox.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        console.error(error);
        resText.innerText = 'ERROR EN LA CONEXI칍N. INTENTA DE NUEVO.';
        resBox.classList.remove('hidden');
      } finally {
        btn.innerText = textoOriginal;
        btn.disabled = false;
      }
    });

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        btn.click();
      }
    });

  }
</script>

