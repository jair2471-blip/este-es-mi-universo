---
import Layout from '../layouts/Layout.astro';
---

<Layout title="ORÁCULO DE HIERRO | Sentencia de la Calle">
  <div class="min-h-screen bg-[#050505] text-white font-sans flex flex-col items-center justify-center p-4 md:p-8 selection:bg-yellow-600">
    <div class="max-w-2xl w-full">

      <!-- HEADER -->
      <div class="text-center mb-12 md:mb-20 space-y-3">
        <h1 class="text-6xl md:text-8xl lg:text-9xl font-black tracking-tighter text-yellow-600 uppercase italic leading-[0.85]">
          ORÁCULO<br /><span class="text-white">DE HIERRO</span>
        </h1>
        <div class="h-1 w-24 bg-yellow-600 mx-auto mt-6"></div>
        <p class="text-zinc-600 tracking-[0.6em] text-[10px] md:text-xs font-bold uppercase pt-3">
          Justicia Final // E.U.L.M
        </p>
      </div>

      <!-- ZONA DE CONSULTA -->
      <div class="space-y-6 md:space-y-8">

        <p class="text-center text-zinc-500 text-xs uppercase tracking-widest font-bold">
          ESCRIBA EN QUÉ FALLÓ HOY
        </p>

        <div class="bg-zinc-950 border border-zinc-900 p-6 md:p-8 rounded-sm">
          <textarea
            id="consulta-input"
            class="w-full bg-transparent text-white outline-none text-xl md:text-2xl placeholder:text-zinc-700 text-center uppercase font-bold resize-none min-h-[80px]"
            placeholder="EJEMPLOS:
NO ENTRENÉ
PROCRASTINÉ TODO EL DÍA
ROMPÍ EL HÁBITO
NO HICE NADA"
            rows="3"></textarea>
        </div>

        <button
          id="btn-consultar"
          class="w-full border-2 border-yellow-600 text-yellow-600 hover:bg-yellow-600 hover:text-black font-black py-5 uppercase italic tracking-[0.25em] transition-all active:scale-[0.98]">
          DÍGAME CÓMO VOLVER
        </button>

        <!-- RESULTADO -->
        <div id="resultado-seccion" class="hidden space-y-10 pt-10">
          <div class="bg-zinc-950 border-2 border-yellow-600 p-10 rounded-sm relative overflow-hidden">
            <div class="absolute top-4 left-4 text-6xl text-zinc-900 font-serif">"</div>
            <div class="absolute bottom-4 right-4 text-6xl text-zinc-900 font-serif">"</div>
            <p
              id="respuesta-texto"
              class="text-4xl md:text-5xl font-black uppercase italic text-center leading-tight">
            </p>
          </div>
        </div>

      </div>
    </div>
  </div>
</Layout>

<script is:inline>
  const btn = document.getElementById('btn-consultar');
  const input = document.getElementById('consulta-input');
  const resBox = document.getElementById('resultado-seccion');
  const resText = document.getElementById('respuesta-texto');

  if (!btn || !input || !resBox || !resText) {
    console.error('ELEMENTOS DEL ORÁCULO NO ENCONTRADOS');
    return;
  }

  btn.addEventListener('click', async () => {
    const consulta = input.value.trim();
    if (!consulta) {
      input.focus();
      return;
    }

    const textoOriginal = btn.innerText;
    btn.innerText = 'DICTANDO SENTENCIA...';
    btn.disabled = true;

    try {
      const r = await fetch('https://mis-frases.poderparatriunfar.workers.dev/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          prompt: `
CONTEXTO:
El usuario admite EN QUÉ FALLÓ HOY: "${consulta}".

OBJETIVO:
EVITAR QUE ABANDONE.

REGLAS:
- UNA sola frase
- Máximo 12 palabras
- TODO en MAYÚSCULAS
- Debe mencionar MAÑANA, VOLVER o DISCIPLINA

DICTE SENTENCIA:
`
        })
      });

      const data = await r.json();
      const frase = data.response || data.text || 'DISCIPLINA. MAÑANA SE VUELVE.';

      resText.innerText = frase;
      resBox.classList.remove('hidden');
      resBox.scrollIntoView({ behavior: 'smooth' });

    } catch (e) {
      console.error(e);
      resText.innerText = 'ERROR DE CONEXIÓN.';
      resBox.classList.remove('hidden');
    } finally {
      btn.innerText = textoOriginal;
      btn.disabled = false;
    }
  });

  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      btn.click();
    }
  });
</script>
