---
// GeneradorVersiculos.astro - VERSI√ìN EXORCISTA
---

<section class="exorcismo-container">
  <div class="bunker-movil">
    
    <div class="app-interna">
      <header>
        <h1 class="titulo-app">POSTALES DEL CIELO</h1>
        <p class="subtitulo">Generador de Bendiciones</p>
      </header>

      <div class="visor-postal">
        <canvas id="mainCanvas" width="1080" height="1350"></canvas>
        <button id="btnRandom" class="float-btn">üîÑ</button>
      </div>

      <div class="formulario-compacto">
        <div class="grupo-input">
          <label>VERS√çCULO</label>
          <textarea id="txtVersiculo" placeholder="Escriba aqu√≠...">Todo lo puedo en Cristo que me fortalece.</textarea>
        </div>

        <div class="grupo-input">
          <label>CITA B√çBLICA</label>
          <input id="txtCita" type="text" value="Filipenses 4:13" />
        </div>

        <div class="botones-container">
          <button id="btnDownload" class="btn-primary">GUARDAR</button>
          <button id="btnShare" class="btn-secondary">ENVIAR</button>
        </div>
      </div>
    </div>

  </div>
</section>

<style is:inline>
  /* EL BLOQUEO TOTAL */
  .exorcismo-container {
    all: initial; /* Borra toda la herencia de la plantilla AstroWind */
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    min-height: 100vh !important;
    background-color: #0f172a !important; /* Fondo oscuro afuera del "celular" */
    font-family: sans-serif !important;
    padding: 20px !important;
  }

  .bunker-movil {
    width: 360px !important; /* TAMA√ëO FIJO EN PIXELES - NO CAMBIA */
    height: 720px !important;
    background: #ffffff !important;
    border: 10px solid #1e293b !important;
    border-radius: 40px !important;
    overflow: hidden !important;
    box-shadow: 0 0 100px rgba(0,0,0,0.5) !important;
    position: relative !important;
    display: block !important;
  }

  .app-interna {
    padding: 20px !important;
    height: 100% !important;
    box-sizing: border-box !important;
    display: flex !important;
    flex-direction: column !important;
    background: white !important;
  }

  .titulo-app {
    font-size: 18px !important;
    text-align: center !important;
    margin: 10px 0 0 0 !important;
    color: #1e293b !important;
    font-weight: bold !important;
  }

  .subtitulo {
    font-size: 10px !important;
    text-align: center !important;
    color: #94a3b8 !important;
    margin-bottom: 20px !important;
  }

  .visor-postal {
    position: relative !important;
    width: 100% !important;
    aspect-ratio: 4/5 !important;
    background: #f1f5f9 !important;
    border-radius: 15px !important;
    overflow: hidden !important;
  }

  #mainCanvas {
    width: 100% !important;
    height: 100% !important;
    display: block !important;
    object-fit: contain !important;
  }

  .float-btn {
    position: absolute !important;
    bottom: 10px !important;
    right: 10px !important;
    background: white !important;
    border-radius: 50% !important;
    border: 1px solid #e2e8f0 !important;
    padding: 8px !important;
    cursor: pointer !important;
  }

  .formulario-compacto {
    margin-top: 20px !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 15px !important;
  }

  .grupo-input label {
    font-size: 10px !important;
    font-weight: bold !important;
    color: #64748b !important;
    display: block !important;
    margin-bottom: 5px !important;
  }

  textarea, input {
    width: 100% !important;
    box-sizing: border-box !important;
    padding: 10px !important;
    border: 1px solid #e2e8f0 !important;
    border-radius: 10px !important;
    font-size: 12px !important;
    background: #f8fafc !important;
  }

  .botones-container {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 10px !important;
  }

  .btn-primary { background: #d97706 !important; color: white !important; border: none !important; padding: 12px !important; border-radius: 10px !important; font-weight: bold !important; cursor: pointer !important; font-size: 11px !important; }
  .btn-secondary { background: #1e293b !important; color: white !important; border: none !important; padding: 12px !important; border-radius: 10px !important; font-weight: bold !important; cursor: pointer !important; font-size: 11px !important; }

</style>

<script is:inline>
  // Script sin dependencias externas
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');
  const textInput = document.getElementById('txtVersiculo');
  const citaInput = document.getElementById('txtCita');

  const fondos = [
    'https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?w=1080&h=1350&fit=crop',
    'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=1080&h=1350&fit=crop',
    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1080&h=1350&fit=crop'
  ];

  let bgImg = new Image();
  bgImg.crossOrigin = "anonymous";
  bgImg.src = fondos[0];

  function redraw() {
    ctx.drawImage(bgImg, 0, 0, 1080, 1350);
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(0, 0, 1080, 1350);
    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.font = "italic 700 85px Georgia";
    
    // Texto simple con salto de l√≠nea b√°sico
    const words = textInput.value.split(' ');
    let line = '';
    let y = 600;
    for(let i=0; i<words.length; i++) {
        let test = line + words[i] + ' ';
        if(ctx.measureText(test).width > 850) {
            ctx.fillText(line, 540, y);
            line = words[i] + ' ';
            y += 110;
        } else { line = test; }
    }
    ctx.fillText(line, 540, y);
    ctx.fillStyle = "#FFD700";
    ctx.font = "bold 55px Arial";
    ctx.fillText(citaInput.value.toUpperCase(), 540, y + 150);
  }

  bgImg.onload = redraw;
  textInput.oninput = redraw;
  citaInput.oninput = redraw;
  document.getElementById('btnRandom').onclick = () => {
    bgImg.src = fondos[Math.floor(Math.random()*fondos.length)];
  };
</script>
