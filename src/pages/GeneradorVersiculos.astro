---
// GeneradorVersiculos.astro - Versi√≥n Pro "Berraco Edition"
---

<div class="max-w-7xl mx-auto p-4 md:p-8 font-['Montserrat'] bg-slate-50 min-h-screen">
    <div class="text-center mb-10">
        <h1 class="text-5xl md:text-6xl font-serif text-slate-800 mb-4 italic">Postales del Cielo</h1>
        <div class="w-32 h-1 bg-gradient-to-r from-amber-400 via-yellow-600 to-amber-400 mx-auto rounded-full shadow-sm"></div>
        <p class="text-slate-500 mt-4 tracking-widest uppercase text-xs font-bold">Luz para tu camino ‚Ä¢ Dise√±o Premium</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center max-w-5xl mx-auto">
    ...
</div>
        <div class="flex justify-center w-full">
    <div class="relative group w-full max-w-[350px]"> <div class="absolute -inset-1 bg-gradient-to-r from-amber-500 to-yellow-600 rounded-2xl blur opacity-20 transition duration-1000"></div>
        <div class="relative bg-white p-2 rounded-xl shadow-2xl">
            <canvas id="mainCanvas" width="1080" height="1350" class="w-full h-auto rounded-lg display-block"></canvas>
        </div>
    </div>
</div>

        <div class="space-y-6">
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                <div class="mb-6">
                    <label class="block text-xs font-black text-slate-400 uppercase tracking-tighter mb-2">Mensaje Sagrado</label>
                    <textarea 
                        id="txtVersiculo" 
                        rows="4" 
                        class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-amber-500 focus:ring-0 transition-all resize-none text-slate-700 italic"
                        placeholder="Escribe el vers√≠culo aqu√≠..."
                    >Todo lo puedo en Cristo que me fortalece.</textarea>
                </div>

                <div class="mb-8">
                    <label class="block text-xs font-black text-slate-400 uppercase tracking-tighter mb-2">Cita B√≠blica</label>
                    <input 
                        id="txtCita" 
                        type="text" 
                        class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-amber-500 focus:ring-0 transition-all text-slate-700 font-bold"
                        value="Filipenses 4:13"
                    />
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button id="btnRandom" class="flex items-center justify-center gap-2 p-4 bg-slate-800 text-white rounded-xl font-bold hover:bg-black transition-all active:scale-95 shadow-lg">
                        <span>üîÑ</span> Fondo
                    </button>
                    <button id="btnDownload" class="flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-amber-500 to-yellow-600 text-white rounded-xl font-bold hover:brightness-110 transition-all active:scale-95 shadow-lg">
                        <span>‚¨áÔ∏è</span> Guardar
                    </button>
                </div>
                
                <button id="btnShare" class="w-full mt-4 p-4 border-2 border-slate-800 text-slate-800 rounded-xl font-bold hover:bg-slate-50 transition-all flex items-center justify-center gap-2">
                    <span>üì±</span> Compartir en WhatsApp / Redes
                </button>
            </div>

            <div class="p-6 bg-amber-50 rounded-2xl border border-amber-100 flex gap-4">
                <span class="text-3xl">‚ú®</span>
                <p class="text-sm text-amber-900 leading-relaxed">
                    <b>Tip de berraco:</b> Usa vers√≠culos cortos para que la letra se vea m√°s grande y potente. ¬°Ideal para Estados de WhatsApp!
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const textInput = document.getElementById('txtVersiculo');
    const citaInput = document.getElementById('txtCita');
    
    // Lista de fondos premium de Unsplash (Naturaleza y Paz)
    const fondos = [
        'https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?w=1080&h=1350&fit=crop',
        'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1080&h=1350&fit=crop',
        'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=1080&h=1350&fit=crop',
        'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=1080&h=1350&fit=crop',
        'https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?w=1080&h=1350&fit=crop'
    ];

    let bgImg = new Image();
    bgImg.crossOrigin = "anonymous";
    bgImg.src = fondos[0];

    function draw() {
        // 1. Limpiar y dibujar fondo
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

        // 2. Capa de contraste (Vi√±eta cinem√°tica)
        const grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 100, canvas.width/2, canvas.height/2, 800);
        grad.addColorStop(0, 'rgba(0,0,0,0.3)');
        grad.addColorStop(1, 'rgba(0,0,0,0.7)');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 3. Configuraci√≥n de Texto (Vers√≠culo)
        const margin = 120;
        const maxWidth = canvas.width - (margin * 2);
        let fontSize = 80;
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        
        // Sombra Pro
        ctx.shadowColor = "rgba(0,0,0,0.8)";
        ctx.shadowBlur = 25;
        ctx.shadowOffsetY = 5;

        // Ajuste inteligente de texto
        let words = textInput.value.split(' ');
        let lines = [];
        let currentLine = words[0];

        // Funci√≥n interna para calcular l√≠neas
        const getLines = (fSize) => {
            ctx.font = `italic ${fSize}px 'Playfair Display', serif`;
            let testLines = [];
            let cLine = words[0];
            for (let i = 1; i < words.length; i++) {
                let test = cLine + " " + words[i];
                if (ctx.measureText(test).width > maxWidth) {
                    testLines.push(cLine);
                    cLine = words[i];
                } else {
                    cLine = test;
                }
            }
            testLines.push(cLine);
            return testLines;
        };

        // Reducir fuente si es mucha letra
        lines = getLines(fontSize);
        while (lines.length * fontSize * 1.3 > 700 && fontSize > 40) {
            fontSize -= 5;
            lines = getLines(fontSize);
        }

        // Dibujar l√≠neas de vers√≠culo
        let startY = (canvas.height / 2) - ((lines.length - 1) * fontSize * 1.3 / 2) - 50;
        lines.forEach((l, i) => {
            ctx.fillText(l, canvas.width / 2, startY + (i * fontSize * 1.3));
        });

        // 4. Adorno Dorado y Cita
        ctx.shadowBlur = 0;
        ctx.shadowOffsetY = 0;
        const lineY = startY + (lines.length * fontSize * 1.3) + 20;
        
        // L√≠nea degradada
        const goldGrad = ctx.createLinearGradient(canvas.width/2 - 100, 0, canvas.width/2 + 100, 0);
        goldGrad.addColorStop(0, 'transparent');
        goldGrad.addColorStop(0.5, '#D4AF37');
        goldGrad.addColorStop(1, 'transparent');
        ctx.fillStyle = goldGrad;
        ctx.fillRect(canvas.width/2 - 150, lineY, 300, 3);

        // Cita
        ctx.fillStyle = "#F3E5AB";
        ctx.font = "bold 45px Montserrat, sans-serif";
        ctx.fillText(citaInput.value.toUpperCase(), canvas.width / 2, lineY + 80);

        // 5. Marca de Agua
        ctx.fillStyle = "rgba(255,255,255,0.4)";
        ctx.font = "25px Montserrat";
        ctx.fillText("Generado con Mi App Biblia", canvas.width / 2, canvas.height - 60);
    }

    // Eventos de interacci√≥n
    bgImg.onload = draw;
    textInput.oninput = draw;
    citaInput.oninput = draw;
    
    document.getElementById('btnRandom').onclick = () => {
        bgImg.src = fondos[Math.floor(Math.random() * fondos.length)];
    };

    document.getElementById('btnDownload').onclick = () => {
        const link = document.createElement('a');
        link.download = `bendicion-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    };

    document.getElementById('btnShare').onclick = async () => {
        const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
        const file = new File([blob], 'versiculo.png', { type: 'image/png' });
        if (navigator.share) {
            navigator.share({ files: [file], title: 'Vers√≠culo del d√≠a' });
        } else {
            alert("¬°Descarga la imagen y comp√°rtela con tus hermanos!");
        }
    };
</script>

<style>
    /* Aseguramos que las fuentes se carguen bien */
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:italic,wght@0,700;1,700&family=Montserrat:wght@400;700;900&display=swap');
</style>
