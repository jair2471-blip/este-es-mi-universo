---
// GeneradorVersiculos.astro - Versi√≥n Anti-Gigante
---

---

---

<div class="page-wrapper">
  <div class="mobile-app">

    <header class="app-header">
      <h1>Generador de Vers√≠culos</h1>
      <div class="divider"></div>
      <p class="subtitle">Crea im√°genes hermosas para compartir la Palabra</p>
    </header>

    <div class="canvas-area">
      <canvas id="versiculo-canvas" width="1080" height="1350"></canvas>
    </div>

    <div class="controls">
      <div class="field">
        <label>Vers√≠culo</label>
        <textarea id="versiculo-text" rows="4">
Porque de tal manera am√≥ Dios al mundo, que ha dado a su Hijo unig√©nito, para que todo aquel que en √©l cree no se pierda, mas tenga vida eterna.
        </textarea>
      </div>

      <div class="field">
        <label>Referencia B√≠blica</label>
        <input type="text" id="cita-text" value="Juan 3:16" />
      </div>

      <div class="actions">
        <button id="actualizar-btn" class="btn-primary">‚ú® Actualizar</button>
        <button id="descargar-btn" class="btn-secondary">‚¨áÔ∏è Descargar</button>
      </div>
    </div>

  </div>
</div>

<style>

/* üî• Esto ignora cualquier layout global */
.page-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  padding: 40px 16px;
  box-sizing: border-box;
}

/* Contenedor tipo m√≥vil */
.mobile-app {
  width: 100%;
  max-width: 420px;
  background: white;
  border-radius: 24px;
  box-shadow: 0 20px 40px rgba(0,0,0,.15);
  padding: 20px;
  box-sizing: border-box;
}

/* Header */
.app-header {
  text-align: center;
  margin-bottom: 20px;
}

.app-header h1 {
  font-size: 1.4rem;
  margin: 0;
  font-weight: 600;
}

.divider {
  width: 60px;
  height: 3px;
  margin: 10px auto;
  border-radius: 10px;
  background: linear-gradient(135deg,#D4AF37,#8B7355);
}

.subtitle {
  font-size: 0.75rem;
  color: #6b7280;
}

/* Canvas */
.canvas-area {
  width: 100%;
  aspect-ratio: 4 / 5;
  border-radius: 16px;
  overflow: hidden;
  background: #f3f4f6;
  margin-bottom: 20px;
}

canvas {
  width: 100%;
  height: 100%;
  display: block;
}

/* Controls */
.controls {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

label {
  font-size: 0.7rem;
  font-weight: 700;
  color: #6b7280;
  text-transform: uppercase;
}

textarea,
input {
  padding: 12px;
  border-radius: 12px;
  border: 2px solid #e5e7eb;
  font-size: 0.9rem;
  box-sizing: border-box;
}

.actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

button {
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-weight: 700;
  cursor: pointer;
}

.btn-primary {
  background: linear-gradient(135deg,#D4AF37,#8B7355);
  color: white;
}

.btn-secondary {
  background: #111827;
  color: white;
}

</style>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const canvas = document.getElementById("versiculo-canvas");
  const ctx = canvas.getContext("2d");
  const versiculoInput = document.getElementById("versiculo-text");
  const citaInput = document.getElementById("cita-text");
  const actualizarBtn = document.getElementById("actualizar-btn");
  const descargarBtn = document.getElementById("descargar-btn");

  const backgroundImage = new Image();
  backgroundImage.crossOrigin = "anonymous";
  backgroundImage.src =
    "https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?w=1080&h=1350&fit=crop&q=80";

  function wrapText(text, maxWidth, fontSize) {
    ctx.font = fontSize + "px serif";
    const words = text.split(" ");
    const lines = [];
    let currentLine = "";

    words.forEach(word => {
      const testLine = currentLine + (currentLine ? " " : "") + word;
      if (ctx.measureText(testLine).width > maxWidth) {
        lines.push(currentLine);
        currentLine = word;
      } else {
        currentLine = testLine;
      }
    });

    if (currentLine) lines.push(currentLine);
    return lines;
  }

  function drawCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const text = versiculoInput.value.trim();
    const maxWidth = canvas.width - 160;
    let fontSize = 64;
    let lines;

    do {
      lines = wrapText(text, maxWidth, fontSize);
      fontSize -= 2;
    } while (
      lines.length * fontSize * 1.4 > canvas.height - 400 &&
      fontSize > 28
    );

    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "center";
    ctx.font = fontSize + "px serif";

    let y =
      canvas.height / 2 - (lines.length * fontSize * 1.4) / 2;

    lines.forEach(line => {
      ctx.fillText(line, canvas.width / 2, y);
      y += fontSize * 1.4;
    });

    ctx.fillStyle = "#D4AF37";
    ctx.font = "bold 48px sans-serif";
    ctx.fillText(
      citaInput.value,
      canvas.width / 2,
      canvas.height - 120
    );
  }

  backgroundImage.onload = drawCanvas;

  actualizarBtn.addEventListener("click", drawCanvas);

  descargarBtn.addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "versiculo.png";
    link.href = canvas.toDataURL();
    link.click();
  });

});
</script>

