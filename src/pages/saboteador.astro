<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modo Inc√≥modo - Verdades que Arden</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0f 100%);
      color: #f2f2f2;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      position: relative;
    }

    /* Efecto de part√≠culas de fondo */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(255, 0, 50, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 0, 0, 0.05) 0%, transparent 50%);
      pointer-events: none;
      animation: pulse 8s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    .container {
      max-width: 700px;
      width: 90%;
      padding: 40px;
      position: relative;
      z-index: 1;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeIn 1s ease forwards;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .logo {
      font-size: 0.75rem;
      letter-spacing: 6px;
      color: #666;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 10px;
      opacity: 0;
      animation: fadeIn 1s ease forwards;
    }

    .tagline {
      font-size: 0.9rem;
      color: #888;
      font-style: italic;
      margin-top: 8px;
      opacity: 0;
      animation: fadeIn 1s ease 0.3s forwards;
    }

    /* Toggle Modo Brutal */
    .brutal-toggle {
      margin-top: 25px;
      opacity: 0;
      animation: fadeIn 1s ease 0.5s forwards;
    }

    .toggle-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      cursor: pointer;
      user-select: none;
    }

    .toggle-label input[type="checkbox"] {
      display: none;
    }

    .toggle-slider {
      position: relative;
      width: 60px;
      height: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 30px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 22px;
      height: 22px;
      background: #fff;
      border-radius: 50%;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .toggle-label input[type="checkbox"]:checked ~ .toggle-slider {
      background: linear-gradient(135deg, #ff1744 0%, #c41230 100%);
      border-color: #ff1744;
      box-shadow: 0 0 20px rgba(255, 23, 68, 0.4);
    }

    .toggle-label input[type="checkbox"]:checked ~ .toggle-slider::before {
      transform: translateX(30px);
      background: #fff;
    }

    .toggle-text {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .mode-normal {
      color: #888;
    }

    .mode-brutal {
      color: #ff1744;
      display: none;
      text-shadow: 0 0 10px rgba(255, 23, 68, 0.5);
    }

    .toggle-label input[type="checkbox"]:checked ~ .toggle-text .mode-normal {
      display: none;
    }

    .toggle-label input[type="checkbox"]:checked ~ .toggle-text .mode-brutal {
      display: inline;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      opacity: 0;
      animation: fadeIn 1s ease 0.6s forwards;
    }

    .stat {
      text-align: center;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: bold;
      color: #ff1744;
      display: block;
    }

    .stat-label {
      font-size: 0.7rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 5px;
    }

    .card {
      background: rgba(20, 20, 20, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 50px 40px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
      transition: left 0.5s;
    }

    .card:hover::before {
      left: 100%;
    }

    .categoria-badge {
      display: inline-block;
      padding: 6px 16px;
      background: rgba(255, 23, 68, 0.15);
      border: 1px solid rgba(255, 23, 68, 0.3);
      border-radius: 20px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #ff1744;
      margin-bottom: 30px;
      font-weight: 600;
      opacity: 0;
      animation: slideIn 0.6s ease forwards;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .frase {
      font-size: 1.75rem;
      line-height: 1.6;
      min-height: 140px;
      font-weight: 500;
      margin: 30px 0;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .frase.show {
      opacity: 1;
      transform: translateY(0);
    }

    .remate {
      font-size: 1.1rem;
      color: #ff1744;
      font-weight: 600;
      margin-top: 25px;
      min-height: 50px;
      font-style: italic;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s;
      position: relative;
      padding-left: 20px;
    }

    .remate::before {
      content: '"';
      position: absolute;
      left: 0;
      top: -5px;
      font-size: 2rem;
      opacity: 0.3;
    }

    .remate.show {
      opacity: 1;
      transform: translateY(0);
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-top: 40px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: stretch;
    }

    button {
      padding: 16px 32px;
      background: linear-gradient(135deg, #ff1744 0%, #c41230 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.5px;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 10px 30px rgba(255, 23, 68, 0.3);
      position: relative;
      overflow: hidden;
      flex: 1;
      min-width: 200px;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(255, 23, 68, 0.5);
    }

    button:active {
      transform: translateY(-1px);
    }

    button span {
      position: relative;
      z-index: 1;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      min-width: 160px;
      flex: 1;
      padding: 16px 20px;
      white-space: nowrap;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .categorias {
      display: flex;
      gap: 10px;
      margin: 30px 0;
      flex-wrap: wrap;
      justify-content: center;
      opacity: 0;
      animation: fadeIn 1s ease 0.9s forwards;
    }

    .cat-btn {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      color: #888;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .cat-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      border-color: rgba(255, 255, 255, 0.2);
    }

    .cat-btn.active {
      background: rgba(255, 23, 68, 0.2);
      border-color: #ff1744;
      color: #ff1744;
    }

    .brutal-cat {
      background: rgba(139, 0, 0, 0.2) !important;
      border-color: rgba(139, 0, 0, 0.3) !important;
      animation: brutalPulse 2s ease-in-out infinite;
    }

    .brutal-cat:hover {
      background: rgba(139, 0, 0, 0.3) !important;
      border-color: #8b0000 !important;
    }

    .brutal-cat.active {
      background: rgba(139, 0, 0, 0.4) !important;
      border-color: #8b0000 !important;
      color: #ff1744;
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
    }

    @keyframes brutalPulse {
      0%, 100% { 
        opacity: 0.8;
        transform: scale(1);
      }
      50% { 
        opacity: 1;
        transform: scale(1.02);
      }
    }

    .favorito-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 10px;
      min-width: auto;
      box-shadow: none;
      opacity: 0.5;
    }

    .favorito-btn:hover {
      opacity: 1;
      transform: scale(1.2);
      box-shadow: none;
    }

    .favorito-btn.active {
      opacity: 1;
    }

    .favoritos-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: rgba(10, 10, 10, 0.98);
      backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      overflow-y: auto;
      transition: right 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 1000;
      box-shadow: -10px 0 50px rgba(0, 0, 0, 0.8);
    }

    .favoritos-panel.open {
      right: 0;
    }

    .favoritos-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .favoritos-header h2 {
      font-size: 1.5rem;
      color: #ff1744;
    }

    .close-btn {
      background: none;
      color: #fff;
      font-size: 1.5rem;
      padding: 5px 10px;
      min-width: auto;
      box-shadow: none;
    }

    .favorito-item {
      padding: 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 3px solid #ff1744;
    }

    .favorito-item p {
      font-size: 0.95rem;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .favorito-item small {
      color: #888;
      font-size: 0.8rem;
      font-style: italic;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    /* Modal de generaci√≥n de im√°genes */
    .image-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .image-modal.open {
      display: flex;
    }

    .image-modal-content {
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 40px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .image-modal-content h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #ff1744;
      font-size: 1.8rem;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      color: #fff;
      font-size: 1.5rem;
      padding: 5px 10px;
      min-width: auto;
      box-shadow: none;
      opacity: 0.7;
    }

    .close-modal:hover {
      opacity: 1;
      transform: none;
      box-shadow: none;
    }

    .format-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .format-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      min-width: auto;
      box-shadow: none;
    }

    .format-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .format-btn.active {
      background: rgba(255, 23, 68, 0.15);
      border-color: #ff1744;
    }

    .format-btn span {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .format-btn small {
      font-size: 0.75rem;
      color: #888;
      text-align: center;
    }

    .format-preview {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #ff1744 0%, #c41230 100%);
      border-radius: 8px;
      opacity: 0.6;
    }

    .square-preview {
      width: 50px;
      height: 50px;
    }

    .story-preview {
      width: 35px;
      height: 60px;
    }

    .horizontal-preview {
      width: 60px;
      height: 35px;
    }

    .canvas-container {
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 300px;
    }

    #imageCanvas {
      max-width: 100%;
      height: auto;
      display: block;
    }

    .download-controls {
      display: flex;
      justify-content: center;
    }

    .download-btn {
      background: linear-gradient(135deg, #ff1744 0%, #c41230 100%);
      font-size: 1.1rem;
      padding: 18px 40px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      .card {
        padding: 30px 25px;
      }
      
      .frase {
        font-size: 1.4rem;
        min-height: 100px;
      }
      
      .remate {
        font-size: 1rem;
      }
      
      button {
        min-width: 100%;
        font-size: 0.9rem;
      }

      .btn-secondary {
        min-width: 100%;
        flex: 1 1 100%;
      }

      .controls {
        gap: 12px;
      }

      .favoritos-panel {
        width: 100%;
        right: -100%;
      }

      .stats {
        gap: 20px;
      }

      .stat-number {
        font-size: 1.4rem;
      }

      .format-selector {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .format-btn {
        flex-direction: row;
        justify-content: flex-start;
        padding: 15px;
      }

      .format-preview {
        width: 40px;
        height: 40px;
      }

      .square-preview {
        width: 35px;
        height: 35px;
      }

      .story-preview {
        width: 25px;
        height: 40px;
      }

      .horizontal-preview {
        width: 40px;
        height: 25px;
      }

      .image-modal-content {
        padding: 25px;
        max-height: 95vh;
      }

      .image-modal-content h2 {
        font-size: 1.4rem;
        margin-bottom: 20px;
      }
    }

    /* Animaci√≥n de shake para el bot√≥n */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .shake {
      animation: shake 0.5s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo animado -->
    <div class="logo-container">
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="width: 120px; height: 120px; margin: 0 auto; display: block;">
        <defs>
          <linearGradient id="flameGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#ff1744;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#c41230;stop-opacity:1" />
          </linearGradient>
          <filter id="logoGlow">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        
        <!-- C√≠rculo de fondo -->
        <circle cx="100" cy="100" r="90" fill="rgba(255, 23, 68, 0.05)" opacity="0.5">
          <animate attributeName="r" values="90;95;90" dur="3s" repeatCount="indefinite"/>
        </circle>
        
        <!-- Llama central -->
        <g transform="translate(100, 100)">
          <path d="M 0,-40 Q -15,-20 -10,0 Q -15,20 0,40 Q 15,20 10,0 Q 15,-20 0,-40 Z" 
                fill="url(#flameGrad)" 
                opacity="0.4"
                filter="url(#logoGlow)">
            <animateTransform
              attributeName="transform"
              type="scale"
              values="1,1;1.1,0.9;1,1"
              dur="2s"
              repeatCount="indefinite"/>
          </path>
          
          <path d="M 0,-25 Q -10,-12 -6,0 Q -10,12 0,25 Q 10,12 6,0 Q 10,-12 0,-25 Z" 
                fill="#ffffff" 
                opacity="0.6"
                filter="url(#logoGlow)">
            <animateTransform
              attributeName="transform"
              type="scale"
              values="1,1;0.9,1.1;1,1"
              dur="1.8s"
              repeatCount="indefinite"/>
          </path>
          
          <circle cx="0" cy="0" r="8" fill="#ffffff" opacity="0.9" filter="url(#logoGlow)">
            <animate attributeName="r" values="8;10;8" dur="1.5s" repeatCount="indefinite"/>
          </circle>
        </g>
        
        <!-- Part√≠culas -->
        <circle cx="80" cy="60" r="2" fill="#ff1744" opacity="0.6">
          <animate attributeName="opacity" values="0;0.8;0" dur="2s" repeatCount="indefinite"/>
          <animate attributeName="cy" values="60;50;60" dur="2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="120" cy="70" r="1.5" fill="#ff1744" opacity="0.6">
          <animate attributeName="opacity" values="0;0.8;0" dur="2.5s" repeatCount="indefinite" begin="0.5s"/>
          <animate attributeName="cy" values="70;60;70" dur="2.5s" repeatCount="indefinite" begin="0.5s"/>
        </circle>
      </svg>
    </div>
    
    <div class="header">
      <div class="logo">MODO INC√ìMODO</div>
      <div class="tagline">Verdades que arden, pero salvan</div>
      
      <!-- Toggle Modo Brutal -->
      <div class="brutal-toggle">
        <label class="toggle-label">
          <input type="checkbox" id="brutalMode" />
          <span class="toggle-slider"></span>
          <span class="toggle-text">
            <span class="mode-normal">Modo Normal</span>
            <span class="mode-brutal">üíÄ MODO BRUTAL</span>
          </span>
        </label>
      </div>
      <div class="stats">
        <div class="stat">
          <span class="stat-number" id="contador">0</span>
          <span class="stat-label">Golpes</span>
        </div>
        <div class="stat">
          <span class="stat-number" id="favCount">0</span>
          <span class="stat-label">Favoritos</span>
        </div>
      </div>
    </div>

    <div class="categorias" id="categorias">
      <button class="cat-btn active" data-cat="todas">Todas</button>
      <button class="cat-btn" data-cat="relaciones">Relaciones</button>
      <button class="cat-btn" data-cat="autoestima">Autoestima</button>
      <button class="cat-btn" data-cat="trabajo">Trabajo</button>
      <button class="cat-btn" data-cat="familia">Familia</button>
      <button class="cat-btn" data-cat="dinero">Dinero</button>
      <button class="cat-btn" data-cat="salud">Salud</button>
      <button class="cat-btn" data-cat="productividad">Productividad</button>
      <button class="cat-btn" data-cat="amistades">Amistades</button>
      <button class="cat-btn" data-cat="habitos">H√°bitos</button>
      <button class="cat-btn" data-cat="ansiedad">Ansiedad</button>
      <button class="cat-btn brutal-cat" data-cat="brutal" style="display: none;">üíÄ Brutal</button>
    </div>

    <div class="card">
      <button class="favorito-btn" id="favBtn">‚òÜ</button>
      <div class="categoria-badge" id="categoriaActual">Relaciones</div>
      <div id="frase" class="frase"></div>
      <div id="remate" class="remate"></div>
      <div class="controls">
        <button id="btn"><span>üí• Dame un golpe de realidad</span></button>
        <button class="btn-secondary" id="shareBtn"><span>üì∏ Crear Imagen</span></button>
        <button class="btn-secondary" id="favoritosBtn"><span>‚≠ê</span></button>
      </div>
    </div>
  </div>

  <!-- Modal para generar im√°genes -->
  <div class="image-modal" id="imageModal">
    <div class="image-modal-content">
      <button class="close-modal" id="closeModal">‚úï</button>
      <h2>üì∏ Crear Imagen para Redes</h2>
      
      <div class="format-selector">
        <button class="format-btn active" data-format="square">
          <div class="format-preview square-preview"></div>
          <span>Cuadrado</span>
          <small>1080x1080 - Instagram/Facebook</small>
        </button>
        <button class="format-btn" data-format="story">
          <div class="format-preview story-preview"></div>
          <span>Historia</span>
          <small>1080x1920 - IG/FB Stories</small>
        </button>
        <button class="format-btn" data-format="horizontal">
          <div class="format-preview horizontal-preview"></div>
          <span>Horizontal</span>
          <small>1200x630 - Twitter/LinkedIn</small>
        </button>
      </div>
      
      <div class="canvas-container">
        <canvas id="imageCanvas"></canvas>
      </div>
      
      <div class="download-controls">
        <button class="download-btn" id="downloadImage">
          <span>‚¨áÔ∏è Descargar Imagen</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Panel de favoritos -->
  <div class="favoritos-panel" id="favoritosPanel">
    <div class="favoritos-header">
      <h2>Tus Favoritos</h2>
      <button class="close-btn" id="closePanel">‚úï</button>
    </div>
    <div id="favoritosList"></div>
  </div>

  <script>
    // Array de sabotajes - se cargar√° desde JSON
    let sabotajes = [];
    let isLoading = true;

    // Funci√≥n para cargar frases desde JSON
    async function cargarFrases() {
      try {
        // En Astro, los archivos de public/ se sirven desde la ra√≠z
        // Si tu archivo est√° en public/data/frases.json
        // La URL es simplemente /data/frases.json
        const response = await fetch('/data/frases.json');
        
        if (!response.ok) {
          throw new Error('No se pudo cargar el archivo JSON');
        }
        
        sabotajes = await response.json();
        isLoading = false;
        
        // Inicializar la app una vez cargadas las frases
        inicializarApp();
      } catch (error) {
        console.error('Error cargando frases:', error);
        isLoading = false;
        mostrarError();
      }
    }

    // Estado de la aplicaci√≥n
    let currentSabotaje = null;
    let categoriaActiva = 'todas';
    let modoBrutal = false;
    let contador = parseInt(localStorage.getItem('contador') || '0');
    let favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');
    
    // Usar el array de sabotajes definido arriba
    const data = sabotajes;

    // Elementos del DOM
    const fraseEl = document.getElementById('frase');
    const remateEl = document.getElementById('remate');
    const btn = document.getElementById('btn');
    const shareBtn = document.getElementById('shareBtn');
    const favBtn = document.getElementById('favBtn');
    const favoritosBtn = document.getElementById('favoritosBtn');
    const categoriaBadge = document.getElementById('categoriaActual');
    const contadorEl = document.getElementById('contador');
    const favCountEl = document.getElementById('favCount');
    const favoritosPanel = document.getElementById('favoritosPanel');
    const closePanel = document.getElementById('closePanel');
    const favoritosList = document.getElementById('favoritosList');
    const imageModal = document.getElementById('imageModal');
    const closeModal = document.getElementById('closeModal');
    const imageCanvas = document.getElementById('imageCanvas');
    const downloadImage = document.getElementById('downloadImage');

    // Inicializar
    contadorEl.textContent = contador;
    favCountEl.textContent = favoritos.length;

    // Variables para generaci√≥n de im√°genes
    let currentFormat = 'square';
    const formats = {
      square: { width: 1080, height: 1080, name: 'cuadrado' },
      story: { width: 1080, height: 1920, name: 'historia' },
      horizontal: { width: 1200, height: 630, name: 'horizontal' }
    };

    // Funci√≥n para mostrar error de carga
    function mostrarError() {
      fraseEl.textContent = 'Error al cargar las frases';
      remateEl.textContent = 'Por favor, recarga la p√°gina o verifica la conexi√≥n.';
      btn.disabled = true;
      btn.style.opacity = '0.5';
    }

    // Funci√≥n de inicializaci√≥n despu√©s de cargar JSON
    function inicializarApp() {
      if (sabotajes.length === 0) {
        mostrarError();
        return;
      }
      
      // Habilitar bot√≥n
      btn.disabled = false;
      btn.style.opacity = '1';
      
      // Generar primera frase
      generar();
      
      // Configurar event listeners
      configurarEventListeners();
    }

    // Funci√≥n para generar sabotaje
    function generar() {
      if (sabotajes.length === 0) return;
      
      // Filtrar por categor√≠a
      let pool = categoriaActiva === 'todas' 
        ? sabotajes 
        : sabotajes.filter(s => s.categoria === categoriaActiva);
      
      // Si no hay frases en el pool, usar todas
      if (pool.length === 0) {
        pool = sabotajes;
      }
      
      // Seleccionar uno aleatorio
      currentSabotaje = pool[Math.floor(Math.random() * pool.length)];
      
      // Animaci√≥n de salida
      fraseEl.classList.remove('show');
      remateEl.classList.remove('show');
      
      setTimeout(() => {
        fraseEl.textContent = currentSabotaje.texto;
        remateEl.textContent = currentSabotaje.remate;
        categoriaBadge.textContent = currentSabotaje.categoria.charAt(0).toUpperCase() + currentSabotaje.categoria.slice(1);
        
        // Actualizar bot√≥n de favorito
        updateFavButton();
        
        // Animaci√≥n de entrada
        setTimeout(() => {
          fraseEl.classList.add('show');
          remateEl.classList.add('show');
        }, 50);
      }, 300);
      
      // Actualizar contador
      contador++;
      localStorage.setItem('contador', contador);
      contadorEl.textContent = contador;
      
      // Animaci√≥n del bot√≥n
      btn.classList.add('shake');
      setTimeout(() => btn.classList.remove('shake'), 500);
    }

    // Funci√≥n para generar imagen
    function generarImagen() {
      if (!currentSabotaje) return;
      
      const format = formats[currentFormat];
      const canvas = imageCanvas;
      const ctx = canvas.getContext('2d');
      
      // Configurar tama√±o del canvas
      canvas.width = format.width;
      canvas.height = format.height;
      
      // Fondo con gradiente
      const gradient = ctx.createLinearGradient(0, 0, 0, format.height);
      gradient.addColorStop(0, '#1a0a0f');
      gradient.addColorStop(1, '#0a0a0a');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, format.width, format.height);
      
      // C√≠rculos decorativos de fondo
      ctx.strokeStyle = 'rgba(255, 23, 68, 0.08)';
      ctx.lineWidth = 2;
      const centerX = format.width / 2;
      const centerY = format.height / 2;
      
      for (let i = 3; i > 0; i--) {
        ctx.beginPath();
        ctx.arc(centerX, centerY, (format.width * 0.15) * i, 0, Math.PI * 2);
        ctx.stroke();
      }
      
      // L√≠nea superior
      ctx.strokeStyle = 'rgba(255, 23, 68, 0.3)';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(format.width * 0.1, format.height * 0.15);
      ctx.lineTo(format.width * 0.9, format.height * 0.15);
      ctx.stroke();
      
      // Logo / T√≠tulo superior
      ctx.fillStyle = '#666';
      ctx.font = `bold ${format.width * 0.025}px -apple-system, system-ui, sans-serif`;
      ctx.textAlign = 'center';
      ctx.letterSpacing = '8px';
      ctx.fillText('MODO INC√ìMODO', centerX, format.height * 0.1);
      
      // Emoji/Icono
      ctx.font = `${format.width * 0.08}px Arial`;
      ctx.fillText('üí•', centerX, format.height * 0.25);
      
      // Texto principal (frase)
      ctx.fillStyle = '#ffffff';
      const maxWidth = format.width * 0.8;
      const lineHeight = format.width * 0.045;
      let fontSize = format.width * 0.04;
      
      // Ajustar tama√±o de fuente seg√∫n formato
      if (currentFormat === 'story') {
        fontSize = format.width * 0.048;
      } else if (currentFormat === 'horizontal') {
        fontSize = format.width * 0.035;
      }
      
      ctx.font = `600 ${fontSize}px -apple-system, system-ui, sans-serif`;
      
      // Dividir texto en l√≠neas
      const words = currentSabotaje.texto.split(' ');
      let lines = [];
      let currentLine = '';
      
      for (let word of words) {
        const testLine = currentLine + word + ' ';
        const metrics = ctx.measureText(testLine);
        
        if (metrics.width > maxWidth && currentLine !== '') {
          lines.push(currentLine);
          currentLine = word + ' ';
        } else {
          currentLine = testLine;
        }
      }
      lines.push(currentLine);
      
      // Dibujar l√≠neas centradas
      const startY = centerY - (lines.length * lineHeight) / 2;
      lines.forEach((line, i) => {
        ctx.fillText(line.trim(), centerX, startY + (i * lineHeight));
      });
      
      // Remate (con gradiente rojo)
      const remateGradient = ctx.createLinearGradient(0, format.height * 0.75, 0, format.height * 0.82);
      remateGradient.addColorStop(0, '#ff1744');
      remateGradient.addColorStop(1, '#f50057');
      ctx.fillStyle = remateGradient;
      
      const remateFontSize = currentFormat === 'story' ? format.width * 0.042 : format.width * 0.036;
      ctx.font = `italic 600 ${remateFontSize}px -apple-system, system-ui, sans-serif`;
      
      // Dividir remate en l√≠neas si es necesario
      const remateWords = currentSabotaje.remate.split(' ');
      let remateLines = [];
      let remateCurrentLine = '';
      
      for (let word of remateWords) {
        const testLine = remateCurrentLine + word + ' ';
        const metrics = ctx.measureText(testLine);
        
        if (metrics.width > maxWidth && remateCurrentLine !== '') {
          remateLines.push(remateCurrentLine);
          remateCurrentLine = word + ' ';
        } else {
          remateCurrentLine = testLine;
        }
      }
      remateLines.push(remateCurrentLine);
      
      const remateStartY = format.height * 0.75;
      remateLines.forEach((line, i) => {
        ctx.fillText(line.trim(), centerX, remateStartY + (i * (remateFontSize * 1.3)));
      });
      
      // L√≠nea inferior
      ctx.strokeStyle = 'rgba(255, 23, 68, 0.3)';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(format.width * 0.1, format.height * 0.88);
      ctx.lineTo(format.width * 0.9, format.height * 0.88);
      ctx.stroke();
      
      // Footer
      ctx.fillStyle = '#666';
      ctx.font = `${format.width * 0.022}px -apple-system, system-ui, sans-serif`;
      ctx.fillText('Verdades que arden, pero salvan', centerX, format.height * 0.94);
    }
    
    // Funci√≥n para abrir modal de imagen
    function abrirModalImagen() {
      if (!currentSabotaje) return;
      imageModal.classList.add('open');
      generarImagen();
    }
    
    // Funci√≥n para descargar imagen
    function descargarImagen() {
      const format = formats[currentFormat];
      const link = document.createElement('a');
      link.download = `modo-incomodo-${format.name}-${Date.now()}.png`;
      link.href = imageCanvas.toDataURL('image/png');
      link.click();
    }

    // Funci√≥n para manejar favoritos
    function toggleFavorito() {
      if (!currentSabotaje) return;
      
      const index = favoritos.findIndex(f => f.texto === currentSabotaje.texto);
      
      if (index === -1) {
        favoritos.push(currentSabotaje);
        favBtn.textContent = '‚òÖ';
      } else {
        favoritos.splice(index, 1);
        favBtn.textContent = '‚òÜ';
      }
      
      localStorage.setItem('favoritos', JSON.stringify(favoritos));
      favCountEl.textContent = favoritos.length;
      renderFavoritos();
    }

    function updateFavButton() {
      if (!currentSabotaje) return;
      const isFav = favoritos.some(f => f.texto === currentSabotaje.texto);
      favBtn.textContent = isFav ? '‚òÖ' : '‚òÜ';
      favBtn.classList.toggle('active', isFav);
    }

    function renderFavoritos() {
      if (favoritos.length === 0) {
        favoritosList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚òÜ</div>
            <p>A√∫n no tienes favoritos</p>
            <small>Guarda las verdades que m√°s te impacten</small>
          </div>
        `;
        return;
      }
      
      favoritosList.innerHTML = favoritos.map(fav => `
        <div class="favorito-item">
          <p>${fav.texto}</p>
          <small>${fav.remate}</small>
        </div>
      `).join('');
    }

    // Event listeners
    function configurarEventListeners() {
      btn.addEventListener('click', generar);
      shareBtn.addEventListener('click', abrirModalImagen);
      favBtn.addEventListener('click', toggleFavorito);
      
      // Toggle Modo Brutal
      const brutalToggle = document.getElementById('brutalMode');
      const brutalCatBtn = document.querySelector('.brutal-cat');
      
      brutalToggle.addEventListener('change', (e) => {
        modoBrutal = e.target.checked;
        localStorage.setItem('modoBrutal', modoBrutal);
        
        // Mostrar/ocultar categor√≠a brutal
        if (modoBrutal) {
          brutalCatBtn.style.display = 'block';
          // Efecto visual al activar
          document.body.style.animation = 'shake 0.5s ease';
          setTimeout(() => {
            document.body.style.animation = '';
          }, 500);
        } else {
          brutalCatBtn.style.display = 'none';
          // Si estaba en categor√≠a brutal, volver a "todas"
          if (categoriaActiva === 'brutal') {
            categoriaActiva = 'todas';
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-cat="todas"]').classList.add('active');
            generar();
          }
        }
      });
      
      // Recuperar estado del modo brutal
      const savedBrutalMode = localStorage.getItem('modoBrutal') === 'true';
      if (savedBrutalMode) {
        brutalToggle.checked = true;
        modoBrutal = true;
        brutalCatBtn.style.display = 'block';
      }
      
      favoritosBtn.addEventListener('click', () => {
        favoritosPanel.classList.add('open');
        renderFavoritos();
      });
      
      closePanel.addEventListener('click', () => {
        favoritosPanel.classList.remove('open');
      });
      
      closeModal.addEventListener('click', () => {
        imageModal.classList.remove('open');
      });
      
      downloadImage.addEventListener('click', descargarImagen);
      
      // Selector de formato
      document.querySelectorAll('.format-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFormat = btn.dataset.format;
          generarImagen();
        });
      });

      // Categor√≠as
      document.querySelectorAll('.cat-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          categoriaActiva = btn.dataset.cat;
          generar();
        });
      });

      // Cerrar panel al hacer click fuera
      favoritosPanel.addEventListener('click', (e) => {
        if (e.target === favoritosPanel) {
          favoritosPanel.classList.remove('open');
        }
      });

      // Atajos de teclado
      document.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          generar();
        }
        if (e.key === 'f' || e.key === 'F') {
          toggleFavorito();
        }
      });
    }

    // Mostrar estado de carga inicial
    fraseEl.textContent = 'Cargando verdades...';
    remateEl.textContent = '';
    btn.disabled = true;
    btn.style.opacity = '0.5';

    // Cargar frases desde JSON al iniciar
    cargarFrases();
  </script>
</body>
</html>