---
import { Image as AstroImage } from 'astro:assets';

const props = Astro.props;
const { src, alt, width, height, ...rest } = props;

if (!alt) {
  throw new Error("El atributo 'alt' es obligatorio.");
}

// 1. Verificamos si la imagen es una ruta de texto (Markdown)
const isLocalString = typeof src === 'string' && (src.startsWith('~/') || src.startsWith('../../') || src.startsWith('/src/'));

// 2. Limpiamos la ruta para que Astro la entienda si viene con tilde
let finalSrc = src;
if (typeof src === 'string' && src.startsWith('~/')) {
    finalSrc = src.replace('~/', '/src/');
}
---

{
  /* Si es una URL externa (http), usamos una etiqueta img normal para no fallar */
  typeof src === 'string' && src.startsWith('http') ? (
    <img src={src} alt={alt} width={width} height={height} {...rest} />
  ) : (
    /* Si es local, usamos el componente de Astro con inferSize para que NO pida dimensiones */
    <AstroImage 
      src={finalSrc as any} 
      alt={alt} 
      width={width || 800} 
      height={height || 450}
      inferSize={true}
      {...rest} 
    />
  )
}